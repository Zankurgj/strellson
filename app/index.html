<!DOCTYPE html>
<html lang="">
  <head>
    <meta charset="utf-8" />
    <title>Project name</title>
    <meta name="viewport" content="width=device-width" />
    <!-- <link rel="icon" href="img/favicon.png" /> -->
    <!-- <meta property="og:image" content="img/dest/preview.jpg" /> -->
    <link rel="stylesheet" href="css/app.min.css" />
  </head>

  <body>
    <!-- Кнопку нужно убрать, оставил для функции  -->

    <!-- <button class="header-btn lk-btn" onclick="onShowLogin(this)">
      <svg class="svg-icon lk-btn-icon">
        <use xlink:href="./images/sprite.symbol.svg#user-icon"></use>
      </svg>
    </button> -->

    <!-- Сам попап, его нужно вставить в конейнер с кнопкой. ".header__personal" - это класс контейнера -->

    <div
      class="header-lk-login-inner header-lk-login-inner--show"
      id="headerLoginPopup"
    >
      <form
        class="header-lk-login-form"
        name="Login Form"
        onsubmit="onSubmitLogin(this);return false;"
      >
        <label class="header-lk-login-input-wrapper">
          <input
            type="text"
            class="header-lk-login-input"
            placeholder="Email или телефон"
            id="phone"
          />
        </label>
        <label class="header-lk-login-input-wrapper">
          <input
            type="password"
            class="header-lk-login-input"
            placeholder="Пароль"
            id="passwordInput"
          />
        </label>
        <label class="header-lk-login-input-wrapper">
          <input
            type="text"
            class="header-lk-login-input"
            style="display: none"
            id="codeInput"
            placeholder="Код"
          />
        </label>
        <button type="submit" class="header-lk-login-submit" id="loginBtn">
          Войти
        </button>
        <button
          type="button"
          class="header-lk-login-submit"
          id="sendBtn"
          style="display: none"
          onclick="onSendCode()"
        >
          Отправить код
        </button>
      </form>
      <div class="header-lk-links">
        <a href="#" class="header-lk-link">Забыли пароль?</a>
        <a href="#" class="header-lk-link">Регистрация</a>
      </div>
      <p class="header-lk-login-sub-title">Авторизоваться через:</p>
      <div class="header-lk-social-wrapper">
        <button class="header-lk-social-item header-lk-social-item-vk">
          <span>Вконтакте</span>
        </button>
        <button class="header-lk-social-item header-lk-social-item-fb">
          <span>Фейсбук</span>
        </button>
        <button class="header-lk-social-item header-lk-social-item-g">
          <span>Гугл</span>
        </button>
      </div>
    </div>
    <script src="js/app.min.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', function () {
        // $(document).on('click', function (e) {
        //   var parent = $('.header-lk-wrapper');
        //   if ($(e.target).closest(parent).length) return;
        //   $('#headerLoginPopup').removeClass('header-lk-login-inner--show');
        //   $('.lk-btn').removeClass('active');
        // });

        var phone = document.getElementById('phone');
        phone.oninput = function (e) {
          var value = phone.value;
          if (!phone.inputmask) {
            if (value.includes('+') || Number(value)) {
              Inputmask({ mask: '+7(999)999-99-99' }).mask(phone);
              hidePwdInput();
              $('#loginBtn').hide();
              $('#sendBtn').show();
            } else {
              if (isValidEmail(value)) {
                // unblockSubmitBtn();
              } else {
                // blockSubmitBtn();
              }
            }
          } else if (phone.inputmask && getRawTelNumber(value) === '') {
            phone.inputmask.remove();
            phone.placeholder = 'Email или телефон';
            showPwdInput();
            hideCodeInput();
            $('#loginBtn').show();
            $('#sendBtn').hide();
          } else if (phone.inputmask && getRawTelNumber(value).length) {
            if (isValidPhoneNumber(getRawTelNumber(value))) {
              // unblockCodeBtn();
            } else {
              // blockCodeBtn();
            }
          }
        };
        var code = document.getElementById('codeInput');
        code.oninput = function (e) {
          if (code.value) {
            unblockSubmitBtn();
          } else {
            blockSubmitBtn();
          }
        };
      });

      function onSubmitLogin() {
        var phone = document.getElementById('phone');
        var code = document.getElementById('codeInput');
        if (isValidEmail(phone.value) || code.value) {
          // Код для отправки
          console.log('Submit');
        } else {
          console.log('No submit');
          return;
        }
      }

      function onSendCode() {
        var phone = document.getElementById('phone');
        if (isValidPhoneNumber(getRawTelNumber(phone.value))) {
          $('#codeInput').show();
          $('#loginBtn').show();
          $('#sendBtn').hide();
        } else {
          return;
        }
      }
      function showCodeInput() {
        $('#codeInput').show();
      }
      function hideCodeInput() {
        $('#codeInput').hide();
      }
      function showPwdInput() {
        $('#passwordInput').show();
      }
      function hidePwdInput() {
        $('#passwordInput').hide();
      }
      function blockCodeBtn() {
        document.querySelector('#sendBtn').disabled = true;
      }
      function unblockCodeBtn() {
        document.querySelector('#sendBtn').disabled = false;
      }
      function blockSubmitBtn() {
        var submitBtn = document.querySelector('#loginBtn');
        submitBtn.disabled = true;
      }
      function unblockSubmitBtn() {
        var submitBtn = document.querySelector('#loginBtn');
        submitBtn.disabled = false;
      }

      function isValidPhoneNumber(value) {
        if (value.length === 12) {
          return true;
        }
        return false;
      }

      function isValidEmail(value) {
        var reg = /^[^\@]+@.*\.[a-z]{2,6}$/i;
        return reg.test(value);
      }

      function getRawTelNumber(val) {
        return val
          .replace(/-/g, '')
          .replace(/_/g, '')
          .replace(/\(/g, '')
          .replace(/\)/g, '');
      }
      function checkVal(elements) {
        for (var i = 0; i < elements.length; i++) {
          if (!elements[i].value) {
            return false;
          }
        }
        return true;
      }

      function onShowLogin(el) {
        el.classList.toggle('active');
        document
          .querySelector('#headerLoginPopup')
          .classList.toggle('header-lk-login-inner--show');
      }
    </script>
  </body>
</html>
